(this.webpackJsonpmonitoing=this.webpackJsonpmonitoing||[]).push([[0],{157:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(49),i=a.n(s),l=(a(58),a(59),a(60),a(2)),c=a(1),o=a(4),m=a(7),u=a(50),d=a(21),f=a(22),h=function(){function e(t){var a=t.eventManager,n=t.itemLabel,r=void 0===n?"Item":n,s=t.eventHandlerItemPrefix,i=void 0===s?"item":s,l=t.fetchUrlPath,c=void 0===l?"/items":l;Object(d.a)(this,e),this.itemLabel=r,this.stateKey=r+"State",this.eventHandlerItemPrefix=i,this.fetchUrlPath=c,this.globalState={},this.setGlobalState=function(e){Object(u.a)(e)},this.eventManager=a,a.subscribe(this),a.showMessage=this.showMessage.bind(this)}return Object(f.a)(e,[{key:"showMessage",value:function(e,t){this.setGlobalState({messages:[{title:e,children:t}].concat(Object(m.a)(this.globalState.messages))})}},{key:"showError",value:function(e,t){this.showMessage(e,t)}},{key:"eventHandler",value:function(e){if(e.message===this.eventHandlerItemPrefix+" deleted"){var t=e.data.id,a=0,n=this.items().filter((function(e,n){return e.id===t&&(a=n),e.id!==t}));this.setItems(n),this.items().length>0&&(a=this.items().length<=a?a-1:a,this.setState({active:this.items()[a].id}))}if(e.message===this.eventHandlerItemPrefix+" added"&&null==this.item(e.data.id).name&&this.setItems([].concat(Object(m.a)(this.items()),[e.data])),e.message===this.eventHandlerItemPrefix+" edited"&&this.updateItem(e.data.id),e.message===this.eventHandlerItemPrefix+" updated"){var r=e.data.id;if(this.setActiveState({lastUpdateEvent:Date.now()/1e3},r),this.state().active===r)this.updateItem(r);else{var s=this.items(),i=s.findIndex((function(e){return e.id===r}));0<=i<s.length&&(s[i].last_reading&&(s[i].last_reading=null),null!=e.data.reading&&(s[i].last_reading=e.data.reading),this.setItems(s))}}"reconnected to server"===e.message&&this.updateItems()}},{key:"state",value:function(){return null==this.globalState[this.stateKey]&&(this.globalState[this.stateKey]={}),this.globalState[this.stateKey]}},{key:"setState",value:function(e){var t=this.state(),a={};a[this.stateKey]=Object(c.a)({},t,{},e),this.setGlobalState(a)}},{key:"activeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state().active;return null==e?{}:null==this.globalState[e]?(this.globalState[e]={},{}):this.globalState[e]}},{key:"setActiveState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state().active;if(null!=t){var a={};a[t]=Object(c.a)({},this.activeState(t),{},e),this.setGlobalState(a)}}},{key:"items",value:function(){return null==this.globalState[this.itemLabel]?(this.globalState[this.itemLabel]=[],this.updateItems(),[]):this.globalState[this.itemLabel]}},{key:"setItems",value:function(e){var t={};t[this.itemLabel]=e,this.setGlobalState(t)}},{key:"item",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state().active,t=this.items().find((function(t){return t.id===e}));return null==t&&(t={}),t}},{key:"setItem",value:function(e){var t=this.items(),a=t.findIndex((function(t){return t.id===e.id}));t[a]=e,this.setItems(t)}},{key:"handleFetchErrors",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(this.itemLabel," error");return e.then((function(e){return e.json()})).then((function(e){return"error"===e.type?(t.showError(a,e.message),null):e})).catch((function(e){t.showError(a,e.message)}))}},{key:"updateItem",value:function(e){var t=this;if(null!=e){var a="."+"".concat(this.fetchUrlPath,"/").concat(e);fetch(a).then((function(e){return e.json()})).then((function(e){t.setItem(e)}))}}},{key:"updateItems",value:function(){var e=this,t="."+this.fetchUrlPath;fetch(t).then((function(e){return e.json()})).then((function(t){e.setItems(t),""===e.state().active&&e.items().length>0&&e.setState({active:"id"in e.items()[0]?e.items()[0].id:"form"})})).catch((function(){""===e.state().active&&e.setState({active:"form"})}))}},{key:"refreshItem",value:function(e){var t=this;if(null==e)return Promise.resolve(null);var a="."+"".concat(this.fetchUrlPath,"/").concat(e,"/update");return this.handleFetchErrors(fetch(a),"Cannot refresh ".concat(this.fetchUrlPath)).then((function(e){null!=e&&t.setItem(Object(c.a)({},t.item(),{last_reading:e}))}))}},{key:"send",value:function(e,t){if(null==e)return Promise.resolve(null);var a="."+"".concat(this.fetchUrlPath,"/").concat(e,"/send");return this.handleFetchErrors(fetch(a,{method:"POST",body:JSON.stringify({message:t,force_send:!0})}),"Failed to cause ".concat(this.item(e).name," ").concat(this.itemLabel.toLowerCase()))}},{key:"deleteItem",value:function(e){if(null==e)return Promise.resolve(null);var t="."+"".concat(this.fetchUrlPath,"/").concat(e);return this.handleFetchErrors(fetch(t,{method:"DELETE",data:{}}),"Cannot delete ".concat(this.item(e).name||this.itemLabel))}},{key:"addItem",value:function(e){var t="."+this.fetchUrlPath;return this.handleFetchErrors(fetch(t,{method:"POST",body:JSON.stringify(e)}),"Cannot create new ".concat(this.itemLabel))}},{key:"editItem",value:function(e){var t="."+this.fetchUrlPath+"/"+e.id;return this.handleFetchErrors(fetch(t,{method:"PUT",body:JSON.stringify(e)}),"Cannot edit ".concat(e.name))}}]),e}();function v(e,t){return function(a){a.preventDefault();var n=a.nativeEvent.target,r=Object(c.a)({},e),s=n.value;n.dataset.factor&&null!=s&&(s*=n.dataset.factor),r[n.name]=s,t(r)}}function b(e){var t=e.children,a=e.className,n=e.name,s=void 0===n?"":n,i=e.label,l=void 0===i?"":i,c=e.state,m=e.setState,u=Object(o.a)(e,["children","className","name","label","state","setState"]);return r.a.createElement("div",{className:"form-group"},""!==l&&r.a.createElement("label",null,l),r.a.createElement("select",Object.assign({className:"form-control "+a,onChange:v(c,m),value:c[s],name:s},u),t))}function g(e){return r.a.createElement("div",{className:"form-group"},"label"in e?r.a.createElement("label",null,e.label||"label"):null,r.a.createElement("div",{className:"input-group"},r.a.createElement("input",{type:e.type||"text",className:"form-control",placeholder:e.placeholder||"",onChange:v(e.state,e.setState),value:null!=e.factor?e.state[e.name]/e.factor:e.state[e.name],list:e.list||"",name:e.name,disabled:e.disabled,"data-factor":e.factor}),"suffix"in e?r.a.createElement("div",{className:"input-group-append"},r.a.createElement("span",{className:"input-group-text"},e.suffix)):""))}function p(e){var t=e.handleClose,a=void 0===t?function(){}:t,n=e.editMode,s=void 0!==n&&n,i=e.label,l=void 0===i?"":i,c=e.children;return r.a.createElement("div",{className:"col-12"},r.a.createElement("button",{type:"submit",className:"btn btn-primary mt-2 px-4"},s?"Apply":"Create ".concat(l)),s?r.a.createElement("button",{type:"button",className:"btn btn-secondary mt-2 ml-2 px-4",onClick:a},"Cancel"):"",c)}function E(e,t,a,n,r,s,i){return function(l){l.preventDefault(),e?i.editItem(a):i.addItem(a).then((function(e){null!=e&&(n(r),s(e.id))})),t()}}var y={type:"HTML",interval:300,name:"",url:"",retain_for:7776e3};function N(e){var t=e.onClick;return r.a.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:function(e){e.preventDefault(),null!=t&&t()}},r.a.createElement("span",{className:"fa fa-plus"}))}function k(e){var t=e.handleRemove,a=e.state,s=e.handleChange,i=e.sensorManager,o=Object(n.useState)(0),m=Object(l.a)(o,2),u=m[0],d=m[1],f=Object(n.useState)({time:0}),h=Object(l.a)(f,2),v=h[0],b=h[1];function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;d((function(t){return t+e}))}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.row,n="".concat(".","/query/").concat(e,"?row=").concat(t);g(),fetch(n).then((function(e){return e.json()})).then((function(e){null!=e[0]?b(e[0]):b({}),g(-1)})).catch((function(){g(-1),b({})}))}function E(e){e.preventDefault();var t=Object(c.a)({},a);t[e.nativeEvent.target.name]=e.nativeEvent.target.value,s(t),"id"===e.nativeEvent.target.name&&p(e.nativeEvent.target.value),"row"===e.nativeEvent.target.name&&p(a.id,e.nativeEvent.target.value)}return Object(n.useEffect)((function(){a.id&&p(a.id)}),[a.id]),[r.a.createElement("div",{key:"remove-button"},r.a.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:function(e){e.preventDefault(),t()}},r.a.createElement("span",{className:"fa fa-minus"}))),r.a.createElement("div",{key:"sensor"},r.a.createElement("select",{className:"form-control form-control-sm mr-2",placeholder:"Sensor",name:"id",value:a.id,onChange:E},r.a.createElement("option",{value:""}),i.items().map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.name)})))),r.a.createElement("div",{key:"channel"},r.a.createElement("select",{className:"form-control form-control-sm mr-2",placeholder:"Channel",name:"channel",value:a.channel,onChange:E},Object.keys(v).map((function(e){return r.a.createElement("option",{key:e,value:e},e)})))),r.a.createElement("div",{key:"index"},r.a.createElement("input",{type:"number",className:"form-control form-control-sm mr-2",placeholder:"-1",name:"row",value:a.row,onChange:E})),r.a.createElement("div",{key:"placeholder"}),r.a.createElement("div",{key:"variable"},r.a.createElement("input",{type:"text",className:"form-control form-control-sm",placeholder:"Variable name (can be used in Expression)",name:"variable",value:a.variable,onChange:E})),r.a.createElement("div",{key:"current-value"},r.a.createElement("div",{className:"form-control form-control-sm bg-light text-truncate text-nowrap text-monospace"},v[a.channel])),r.a.createElement("div",{key:"update-button",className:"mb-2"},r.a.createElement("button",{type:"button",className:"btn btn-sm btn-light w-100",onClick:function(e){e.preventDefault(),p(a.id)}},u>0?r.a.createElement("i",{className:"spinner-border spinner-border-sm"}):r.a.createElement("i",{className:"fa fa-sync"})))]}function S(e){var t=e.actions,a=e.setActions,n=e.actionManager;return r.a.createElement("div",null,r.a.createElement("ul",{className:"list-group"},t.map((function(e,s){return r.a.createElement("div",{className:"list-group-item p-0",key:s},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("button",{className:"btn btn-light",type:"button",onClick:function(){return a(t.filter((function(e,t){return s!==t})))}},r.a.createElement("i",{className:"fas fa-minus"}))),r.a.createElement("select",{className:"border-0 custom-select",value:e,onChange:function(e){var n=Object(m.a)(t);n[s]=e.nativeEvent.target.value,a(n)}},n.items().map((function(e,t){return r.a.createElement("option",{value:e.id,key:t},e.name)})))))}))),r.a.createElement("div",{className:"btn btn-light mt-1",onClick:function(){a([].concat(Object(m.a)(t),[n.items().length>0?n.items()[0].id:""]))}},r.a.createElement("i",{className:"fa fa-plus"})))}var x={channel:"time",row:-1,id:"",variable:"A"},O={name:"New Trigger",retain_for:7776e3,expression:"",variables:[x],action_ids:[],message:"",expressionMessage:"",expressionError:!1};function w(e){var t=e.variables,a=e.setVariables,n=e.sensorManager;function s(){if(0===t.length)return x;var e=Object(c.a)({},t.slice(-1)[0]);e.variable=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;function t(e){return e.charAt(Math.floor(Math.random()*e.length))}for(var a="aeoui",n="qwrtzipsdfghjklyxcvbnm",r="",s=0;s<e;s++)r+=t(s%2===0?n:a);return r}(3),a([].concat(Object(m.a)(t),[e]))}return[].concat(Object(m.a)(t.map((function(e,s){return r.a.createElement(k,{sensorManager:n,key:s,state:e,handleRemove:function(){a(t.filter((function(e,t){return t!==s})))},handleChange:function(e){var n=Object(m.a)(t);n[s]=e,a(n)}})}))),[r.a.createElement(N,{key:"add-button",onClick:function(){s()}})])}var j={type:"DebugAction",cooldown:300,name:"",url:"",method:"get",retain_for:7776e3};function M(e){return r.a.createElement("li",{className:"list-group-item list-group-item-transparent list-group-item-action \n            ".concat(e.active?"active":""," ")+e.className,style:{cursor:"default"},onClick:e.onClick},r.a.createElement("span",{style:{width:"48px"}},e.iconLeft),e.children,r.a.createElement("span",{className:"float-right"},e.iconRight))}function C(e){var t=Object(n.useState)(!1),a=Object(l.a)(t,2),s=a[0],i=a[1];return[r.a.createElement("li",{className:"list-group-item list-group-item-action",onClick:function(){return i(!s)},style:{cursor:"pointer",borderBottom:"none"},key:"1"},r.a.createElement("i",{className:"fas fa-chevron-right fa-sm mr-2",style:s?{transform:"rotate(90deg)"}:{}}),r.a.createElement("span",{className:"text-monospace"},e.label),r.a.createElement("span",{className:"float-right font-weight-light"},e.value)),r.a.createElement("li",{className:"list-group-item custom-collapse ".concat(s?"show":""," py-0"),key:"2"},r.a.createElement("div",{className:"py-3"},s?e.children:null))]}var I=a(32),P=a.n(I);function _(e){if(null!==e)return(e=e.toString()).length<40?e:"".concat(e.slice(0,37),"...")}function L(e){return"".concat(Math.round(e/60*10)/10," minute").concat(60!==e?"s":"")}var A=new Proxy({elapsed:function(e){return"".concat(Math.round(1e3*e)," ms")},time:function(e){return new Date(1e3*e).toLocaleString()},percentage:function(e){return"".concat(Math.round(10*e)/10," %")},seconds:function(e){return"".concat(Math.round(e)," (").concat(Math.round(10*e/60/60/24)/10," days)")},url:function(e){return r.a.createElement("a",{href:decodeURIComponent(e),target:"_blank",rel:"noopener noreferrer"},decodeURIComponent(e))},interval:L,cooldown:L,type:function(e){return r.a.createElement("kbd",{className:"bg-light text-dark"},e)},retain_for:function(e){return"".concat(Math.round(e/24/60/60*10)/10," days")},expression:function(e){return r.a.createElement("div",{className:"text-monospace"},e)},broken:function(e){return e?r.a.createElement("span",{className:"fas fa-times text-danger"}):r.a.createElement("span",{className:"fas fa-check text-success"})},last_notify:function(e){return e<0?"never":"".concat(new Date(1e3*e).toLocaleString()," (").concat(P()(1e3*e).fromNow(),")")},queued_messages:function(e){return e.map((function(e,t){return r.a.createElement("div",{key:t},e)}))}},{get:function(e,t){return t in e?e[t]:_}}),T=["last_reading","last_update","kwargs","enabled","id","name"],U=new Proxy({url:"Target URL",retain_for:"Retain readings for",last_notify:"Last notified",queued_messages:"Queued messages",api_token:"Api token",user_key:"User key",action_ids:"Actions"},{get:function(e,t){return t in e?e[t]:r.a.createElement("span",{className:"text-capitalize"},t)}});function R(e){var t=Object(n.useState)(!0),a=Object(l.a)(t,2),s=a[0],i=a[1];return Object(n.useEffect)((function(){setTimeout((function(){i(!1)}),3e3)}),[]),null==e?s?r.a.createElement("i",{className:"spinner-grow spinner-grow-lg text-secondary mx-auto my-5"}):r.a.createElement("h4",{className:"text-muted text-lg mx-auto my-5"},r.a.createElement("i",{className:"fa fa-server mr-2"}),"Cannot connect to server \ud83d\ude14"):Object.keys(e).map((function(t){return r.a.createElement(C,{key:t,label:t,value:A[t](e[t])},e[t])}))}function H(e){var t=e.label,a=e.children;return r.a.createElement("li",{className:"list-group-item px-0"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-3 h5 text-secondary m-0"},t),r.a.createElement("div",{className:"col-9"},a)))}function D(e){var t=e.showSpinner,a=e.className,n=Object(o.a)(e,["showSpinner","className"]);return r.a.createElement("button",Object.assign({className:"btn btn-light mr-2 "+a},n),t?r.a.createElement("i",{className:"spinner-border spinner-border-sm"}):n.children)}function F(e){var t=e.children,a=e.onClick,s=e.sureClass,i=void 0===s?"border-primary":s,c=Object(o.a)(e,["children","onClick","sureClass"]),m=Object(n.useState)(!1),u=Object(l.a)(m,2),d=u[0],f=u[1];return r.a.createElement(D,Object.assign({onClick:function(e){d&&a(e),!d&&setTimeout((function(){f(!1)}),3e3),f(!d)},className:d?i:""},c),t)}function V(e){var t=e.stateManager,a=Object(n.useState)(!1),s=Object(l.a)(a,2),i=s[0],c=s[1],m=Object(n.useState)(!1),u=Object(l.a)(m,2),d=u[0],f=u[1],h=t.state().active;return r.a.createElement("div",{className:"header-buttons float-right my-auto"},r.a.createElement(D,{showSpinner:i,onClick:function(){i||(c(!0),("action"===t.eventHandlerItemPrefix?t.send(h,"".concat(t.item().name,": Test Message :)")):t.refreshItem(h)).then((function(){c(!1)})).catch((function(){c(!1)})))},disabled:t.activeState().editMode},"action"===t.eventHandlerItemPrefix?r.a.createElement("i",{className:"fa fa-comment"}):r.a.createElement("i",{className:"fa fa-sync"})),r.a.createElement(F,{showSpinner:d,onClick:function(){return function(){var e=t.item(),a=(e.last_reading,e.last_update,e.id,Object(o.a)(e,["last_reading","last_update","id"]));a.name+=" (copy)",f(!0),t.addItem(a).then((function(){f(!1)})).catch((function(){f(!1)}))}()},disabled:t.activeState().editMode},r.a.createElement("i",{className:"fa fa-copy"})),r.a.createElement(D,{onClick:function(){return t.setActiveState({editMode:!t.activeState().editMode})}},r.a.createElement("i",{className:"fa fa-edit"})),r.a.createElement(F,{sureClass:"border-danger",onClick:function(){return t.deleteItem(h)}},r.a.createElement("i",{className:"fa fa-trash text-danger"})))}function G(e){var t=e.stateManager,a=e.FormView,s=e.children,i=Object(o.a)(e,["stateManager","FormView","children"]),l=t.state().active;function m(e){t.setActiveState({formState:Object(c.a)({},t.activeState().formState,{},e)})}return Object(n.useEffect)((function(){null==t.item().last_reading&&t.updateItem(l)}),[l]),!0===t.activeState().editMode?[r.a.createElement(V,{stateManager:t,key:"Buttons"}),r.a.createElement("div",{className:"main px-3"},r.a.createElement(a,Object.assign({key:"form",state:Object(c.a)({},t.item(),{},t.activeState().formState),setState:m,editMode:!0,stateManager:t,handleClose:function(){t.setActiveState({editMode:!1,formState:{}})}},i)))]:[r.a.createElement(V,{stateManager:t,key:"ButtonsDetail"}),r.a.createElement("div",{className:"main px-3",key:"detail"},function(e){var t={variables:function(e){return e.map((function(e,t){var a=e.id;try{a=i.sensorManager.items().find((function(t){return t.id===e.id})).name}catch(n){}return r.a.createElement("div",{className:"text-monospace text-large",key:t},r.a.createElement("code",{className:""},e.variable)," = ",r.a.createElement("kbd",null,a),".",r.a.createElement("kbd",null,e.channel),"[",r.a.createElement("kbd",null,e.row),"]")}))},action_ids:function(e){return e.map((function(e,t){return r.a.createElement("kbd",{key:t,className:"mr-2"},null!=i.actionManager&&i.actionManager.item(e).name||e)}))}};return r.a.createElement("ul",{className:"list-group list-group-flush"},Object.entries(e).map((function(e){var a=e[0],n=e[1];return null!=n&&""!==n&&!T.includes(a)&&r.a.createElement(H,{label:U[a],key:a},a in t?t[a](n):A[a](n))})))}(t.item()),s)]}var J=function(){function e(){Object(d.a)(this,e),this.subscriptions=[],this.showMessage=function(){},this.listen()}return Object(f.a)(e,[{key:"onMessage",value:function(e){try{var t=JSON.parse(e.data);this.handleEvent(t)}catch(a){this.showMessage("Event Source Parsing","Could not parse message. "+a)}}},{key:"onError",value:function(){var e=this;setTimeout((function(){console.log("Lost connection to EventSource. Reconnecting..."),e.source.close(),e.source=null,e.listen(!0)}),3e3)}},{key:"onReconnect",value:function(){console.log("Reconnected to EventSource"),this.handleEvent({message:"reconnected to server"})}},{key:"listen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.source=new EventSource("./events"),this.source.onmessage=this.onMessage.bind(this),this.source.onerror=this.onError.bind(this),e&&(this.source.onopen=this.onReconnect.bind(this))}},{key:"handleEvent",value:function(e){var t=this.showMessage;this.subscriptions.forEach((function(a){try{a.eventHandler(e)}catch(n){t("Event Handler Failed","Event handler threw the following exception: "+n)}}))}},{key:"subscribe",value:function(e){this.subscriptions.push(e)}},{key:"unsubscribe",value:function(e){var t=this.subscriptions.indexOf(e);delete this.subscriptions[t]}}]),e}();function q(e){var t=e.stateManager,a=e.item;function n(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"light";return r.a.createElement("div",{className:"badge font-weight-normal badge-"+n},e,t.activeState(a.id).editMode&&r.a.createElement("i",{className:"fas fa-edit ml-2"}))}return"trigger"===t.eventHandlerItemPrefix?null==a.last_reading?null:null==a.last_reading.state?n("broken","warning"):a.last_reading.state?n("triggering","primary"):n("not triggering"):n(a.type)}function z(e){var t=e.stateManager,a=e.item,s=Object(n.useState)("initial"),i=Object(l.a)(s,2),c=i[0],o=i[1];return Object(n.useEffect)((function(){"initial"!==c?(o("flash"),setTimeout((function(){return o("")}),1e3)):o("")}),[t.activeState(a.id).lastUpdateEvent]),r.a.createElement(M,{className:c,onClick:function(){return t.setState({active:a.id})},active:t.state().active===a.id,iconRight:r.a.createElement(q,{stateManager:t,item:a})},a.name)}function K(e){var t,a=e.stateManager;return Object(n.useEffect)((function(){null==a.state().active&&null!=a.items()[0]&&a.setState({active:a.items()[0].id})}),[a.state().active,a.items()]),[r.a.createElement("li",{className:"list-group-item list-group-item-transparent list-group-item-action \n        ".concat("form"===a.state().active?"active":""),key:"button",style:{cursor:"default"},onClick:function(){return a.setState({active:"form"})}},r.a.createElement("h3",{className:"mb-1"},"New ",a.itemLabel,r.a.createElement("span",{className:"float-right"},r.a.createElement("i",{className:"fa fa-xs fa-plus"})))),r.a.createElement("input",{className:"input-group-sm list-group-item list-group-item-transparent w-100 icon-placeholder py-2",placeholder:"\uf002 Filter",value:a.state().filter,key:"Filter",onChange:function(e){return a.setState({filter:e.target.value})}}),(t=a.items().filter((function(e){var t=(a.state().filter||"").toLowerCase();return Object.keys(e).some((function(a){try{return e[a].toLowerCase().includes(t)}catch(n){return!1}}))})),null==t?null:t.map((function(e){return r.a.createElement(z,{stateManager:a,item:e,key:e.id})})))]}var B=a(51);a(155);function W(e){var t=e.data,a=e.title,n=Object(o.a)(e,["data","title"]);var s={responsive:!0,hoverMode:"index",stacked:!1,title:{display:!0,text:a||""},scales:{yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1"},{type:"linear",display:!1,position:"right",id:"y-axis-2",gridLines:{drawOnChartArea:!1}}],xAxes:[{type:"time"}]},plugins:{zoom:{pan:{enabled:!1},zoom:{enabled:!0,drag:!0,mode:"x",speed:1,threshold:.1}}}},i=r.a.createRef();function l(){i.current.chartInstance.resetZoom()}return r.a.createElement("div",Object.assign({},n,{onDoubleClick:l}),r.a.createElement(B.a,{data:function(e){return{labels:e.map((function(e,t){return t})),datasets:[{label:"My First dataset",borderColor:"#fa9121",backgroundColor:"#fa912111",fill:!0,data:e,hidden:!0},{label:"My Second dataset",borderColor:"#21af61",backgroundColor:"#21af61",fill:!1,data:e.map((function(e){return 1.2*e}))}]}}(t),options:s,ref:i}),r.a.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:l},r.a.createElement("i",{className:"fa fa-search"})," Reset Zoom"))}function Z(e){var t=e.title,a=e.children,n=e.className,s=void 0===n?"":n,i=e.handleClose;Object(o.a)(e,["title","children","className","handleClose"]);return r.a.createElement("div",{className:"toast show "+s,style:{minWidth:"180px"}},r.a.createElement("div",{className:"toast-header"},r.a.createElement("strong",{className:"mr-auto"},t),r.a.createElement("button",{type:"button",className:"ml-2 mb-1 close",onClick:i},r.a.createElement("span",null,"\xd7"))),r.a.createElement("div",{className:"toast-body"},a))}function Q(e){var t=e.handleClose,a=void 0===t?function(){}:t;return r.a.createElement("button",{type:"button",className:"btn float-right text-muted",onClick:a},r.a.createElement("div",{className:"close ml-2"},r.a.createElement("span",null,"\xd7")),r.a.createElement("small",{className:"text-small"},"dismiss all"))}function X(e){var t=e.messages,a=e.setMessages;return null==t?null:r.a.createElement("div",{className:"message-container"},t.map((function(e,n){return r.a.createElement(Z,{handleClose:function(){a(t.filter((function(e,t){return t!==n})))},title:e.title,key:n},e.children)})),t.length>0&&r.a.createElement(Q,{handleClose:function(){return a([])}}))}function Y(e){return r.a.createElement("div",{className:"sidebar bg-night shadow-sm"},r.a.createElement("ul",{className:"list-group list-group-flush"},e.children))}function $(e){var t=e.FormView,a=e.stateManager,n=e.children,s=Object(o.a)(e,["FormView","stateManager","children"]);return[r.a.createElement("div",{className:"header h2 text-dark my-auto px-3",key:"header"},a.item().name||"Create New"),"form"===a.state().active?r.a.createElement("div",{className:"main px-3",key:"FormView"},r.a.createElement(t,Object.assign({state:a.state().formState,setState:function(e){a.setState({formState:Object(c.a)({},a.state().formState,{},e)})},setActive:function(e){a.setState({active:e})},stateManager:a},s))):r.a.createElement(G,Object.assign({key:"DetailView",stateManager:a,FormView:t},s),n)]}var ee=new J,te={sensors:{manager:new h({eventManager:ee,itemLabel:"Sensor",eventHandlerItemPrefix:"sensor",fetchUrlPath:"/sensors"}),form:function(e){var t=e.editMode,a=void 0!==t&&t,n=e.state,s=void 0===n?y:n,i=e.setState,l=e.handleClose,c=void 0===l?function(){}:l,o=e.setActive,m=void 0===o?function(){}:o,u=e.stateManager,d=E(a,c,s,i,y,m,u),f={state:s,setState:i};return r.a.createElement("form",{onSubmit:d,className:"row"},r.a.createElement("div",{className:"col-lg-4",style:{borderRight:"1px solid #dee2e6"}},r.a.createElement("h4",null,"Type"),r.a.createElement(b,Object.assign({label:" ",name:"type",disabled:a},f),r.a.createElement("option",{value:"HTML"},"HTML - Grabs HTTP response from a URL"),r.a.createElement("option",{value:"CPUPercentage"},"CPUPercentage - Host system CPU usage"),r.a.createElement("option",{value:"RAMPercentage"},"RAMPercentage - Host system memory usage"),r.a.createElement("option",{value:"Uptime"},"Uptime - Host system uptime"))),r.a.createElement("div",{className:"col-lg-4",style:{borderRight:"1px solid #dee2e6"}},r.a.createElement("h4",null,"Info"),r.a.createElement(g,Object.assign({},f,{label:"Name:",name:"name"})),r.a.createElement(g,Object.assign({},f,{label:"Update interval:",name:"interval",type:"number",suffix:"minutes",factor:60})),r.a.createElement(g,Object.assign({},f,{label:"Retain for:",name:"retain_for",type:"number",suffix:"days",factor:86400}))),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("h4",null,"Type Specific Info"),"HTML"===s.type?r.a.createElement(g,Object.assign({label:"Target URL:",name:"url"},f)):""),r.a.createElement(p,{handleClose:c,editMode:a,label:"Sensor"}))},moreInfo:function(e){var t=e.stateManager,a=t.state().activeDetailView||0,n=function(e){t.setState({activeDetailView:e})};return r.a.createElement("div",{className:"mt-3"},"HTML"===t.item().type&&r.a.createElement("button",{className:"btn btn-sm btn-outline-primary mb-2",onClick:function(){window.open(t.item().url).document.write(t.item().last_reading.content)}},r.a.createElement("span",{className:"fa fa-external-link-alt mr-2"}),"Open HTML content of last reading in new window"),r.a.createElement("div",{className:"btn-group mb-2 w-100"},r.a.createElement("button",{type:"button",className:"btn btn-light ".concat(0===a?"active":""),onClick:function(){n(0)}},r.a.createElement("span",{className:"fas fa-database mr-2"}),"Raw Data"),r.a.createElement("button",{type:"button",className:"btn btn-light ".concat(1===a?"active":""),onClick:function(){n(1)}},r.a.createElement("span",{className:"fas fa-chart-area mr-2"}),"History")),0===a&&r.a.createElement("div",null,r.a.createElement("ul",{className:"list-group"},R(t.item().last_reading)),r.a.createElement("span",{className:"text-muted font-weight-normal"},"data from last reading")),3===a&&r.a.createElement(W,{className:"mb-2",data:t.activeState().chartData||[0,2,3,1,4,2,4,2,1]}))}},triggers:{manager:new h({eventManager:ee,itemLabel:"Trigger",eventHandlerItemPrefix:"trigger",fetchUrlPath:"/triggers"}),form:function(e){var t=e.editMode,a=void 0!==t&&t,s=e.state,i=void 0===s?O:s,l=e.setState,o=e.handleClose,m=void 0===o?function(){}:o,u=e.setActive,d=void 0===u?function(){}:u,f=e.actionManager,h=e.sensorManager,v=e.stateManager;Object(n.useEffect)((function(){""!==i.expression&&function(e,t){var a={expression:e,variables:t};fetch("./evaluate",{method:"post",body:JSON.stringify(a)}).then((function(e){return e.json()})).then((function(e){l(Object(c.a)({},i,{expressionMessage:e.message,expressionError:e.error}))}))}(i.expression,i.variables)}),[i.expression,i.variables]);var b=E(a,m,i,l,O,d,v),y={state:i,setState:l};return r.a.createElement("form",{onSubmit:b},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement(g,Object.assign({label:"Name:",name:"name"},y))),r.a.createElement("div",{className:"col-md-6"},r.a.createElement(g,Object.assign({label:"Retain history for:",type:"number",name:"retain_for",suffix:"days",factor:86400},y)))),r.a.createElement("hr",null),r.a.createElement("h4",null,"Variables"),r.a.createElement("div",{className:"variable-input-grid"},r.a.createElement("div",null),r.a.createElement("div",null,"Sensor:"),r.a.createElement("div",null,"Channel:"),r.a.createElement("div",null,"Index:"),r.a.createElement(w,{sensorManager:h,variables:i.variables,setVariables:function(e){l(Object(c.a)({},i,{variables:e}))}})),r.a.createElement("hr",null),r.a.createElement("h4",null,"Expression"),r.a.createElement(g,Object.assign({type:"text",className:"form-control text-monospace mb-1",placeholder:'A == 3 or "substing" in long_string',name:"expression"},y)),""===i.expression?null:r.a.createElement("div",{className:"alert ".concat(i.expressionError?"alert-danger":[!0,!1].includes(i.expressionMessage)?"alert-success":"alert-warning")},"expressionMessage"in i&&i.expressionMessage.toString()),r.a.createElement("h4",null,"Action"),r.a.createElement(S,{actionManager:f,actions:i.action_ids,setActions:function(e){l(Object(c.a)({},i,{action_ids:e}))}}),r.a.createElement(g,Object.assign({label:"Message:",name:"message"},y)),r.a.createElement(p,{label:"Trigger",handleClose:m,editMode:a}))},moreInfo:function(e){var t=e.stateManager;return r.a.createElement("div",{className:"mt-3"},r.a.createElement("h4",null,"Last Check"),r.a.createElement("ul",{className:"list-group"},R(t.item().last_reading)))}},actions:{manager:new h({eventManager:ee,itemLabel:"Action",eventHandlerItemPrefix:"action",fetchUrlPath:"/actions"}),form:function(e){var t=e.editMode,a=void 0!==t&&t,s=e.state,i=void 0===s?j:s,c=e.setState,o=e.handleClose,m=void 0===o?function(){}:o,u=e.setActive,d=void 0===u?function(){}:u,f=e.stateManager,h=Object(n.useState)(!1),v=Object(l.a)(h,2),y=v[0],N=v[1],k=E(a,m,i,c,j,d,f),S={state:i,setState:c};return r.a.createElement("form",{onSubmit:k,className:"row"},r.a.createElement("div",{className:"col-lg-4",style:{borderRight:"1px solid #dee2e6"}},r.a.createElement("h4",null,"Type"),r.a.createElement(b,Object.assign({label:" ",name:"type",disabled:a},S),r.a.createElement("option",{value:"DebugAction"},"DebugAction - Debug print statement"),r.a.createElement("option",{value:"PushoverAction"},"Pushover - Sends a push notification"),r.a.createElement("option",{value:"WebhookAction"},"Webhook - Makes a webrequest"),r.a.createElement("option",{value:"RebootAction"},"Reboot - only works on Linux"))),r.a.createElement("div",{className:"col-lg-4",style:{borderRight:"1px solid #dee2e6"}},r.a.createElement("h4",null,"Info"),r.a.createElement(g,Object.assign({label:"Name:",name:"name"},S)),r.a.createElement(g,Object.assign({label:"Cooldown:",name:"cooldown",type:"number",suffix:"minutes",factor:60},S)),r.a.createElement(g,Object.assign({label:"Retain for:",name:"retain_for",type:"number",suffix:"days",factor:86400},S))),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("h4",null,"Type Specific Info"),"PushoverAction"===i.type&&[r.a.createElement(g,Object.assign({label:"Api token:",name:"api_token",key:"api_token"},S)),r.a.createElement(g,Object.assign({label:"User key:",name:"user_key",key:"user_key"},S)),r.a.createElement(g,Object.assign({label:"Device:",name:"device",key:"device"},S))],"WebhookAction"===i.type&&[r.a.createElement(g,Object.assign({label:"Url:",name:"url",key:"url"},S)),r.a.createElement(b,Object.assign({label:"Method:",name:"method",key:"method"},S),r.a.createElement("option",{value:"get"},"get"),r.a.createElement("option",{value:"post"},"post"),r.a.createElement("option",{value:"put"},"put"),r.a.createElement("option",{value:"delete"},"delete"))],"RebootAction"===i.type&&r.a.createElement("div",null,"This trigger sends the ",r.a.createElement("code",null,"shutdown -h now")," command. To make rebooting work, without giving basicmonitor root privileges, you need to run:",r.a.createElement("br",null),r.a.createElement("code",{className:"label grey"},"sudo chmod u+s /sbin/shutdown"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("a",{href:"https://linux.byexamples.com/archives/315/how-to-shutdown-and-reboot-without-sudo-password/"},"source: byexamples.com"))),r.a.createElement(p,{editMode:a,handleClose:m,label:"Action"},null!=i.id&&null!=f&&r.a.createElement("button",{type:"button",className:"btn btn-secondary mt-2 ml-2 px-4",onClick:function(){N(!0),f.send(i.id,"".concat(i.name,": Test message :)")).then((function(){N(!1)})).catch((function(){N(!1)}))}},y&&r.a.createElement("i",{className:"spinner-border spinner-border-sm mr-2"}),"Send Test Notification")))},moreInfo:function(e){var t=e.stateManager;return r.a.createElement("div",{className:"mt-3"},r.a.createElement("h4",null,"Last Message"),r.a.createElement("ul",{className:"list-group"},R(t.item().last_reading)))}}};function ae(){var e=Object(n.useState)({messages:[]}),t=Object(l.a)(e,2),a=t[0],s=t[1];function i(e){s(Object(c.a)({},a,{},e))}Object.keys(te).map((function(e){te[e].manager.globalState=a,te[e].manager.setGlobalState=i}));var o=Object(n.useState)("sensors"),m=Object(l.a)(o,2),u=m[0],d=m[1];var f=te[u].manager,h=te[u].moreInfo;return r.a.createElement("div",null,r.a.createElement("div",{className:"main-grid"},r.a.createElement(Y,null,r.a.createElement("div",{className:"btn-group w-100 px-1 py-2"},function(){var e={sensors:r.a.createElement("span",{className:"fas fa-ruler-vertical mr-2"}),triggers:r.a.createElement("span",{className:"fas fa-calculator mr-2"}),actions:r.a.createElement("span",{className:"fas fa-bullseye mr-2"})};return Object.keys(te).map((function(t){return r.a.createElement("button",{type:"button",className:"btn btn-outline-transparent text-white px-1 text-capitalize \n                        ".concat(u===t?"active":""),key:t,onClick:function(){d(t)}},e[t],r.a.createElement("br",null),t)}))}()),r.a.createElement(K,{stateManager:f})),r.a.createElement($,{stateManager:f,FormView:te[u].form,sensorManager:te.sensors.manager,actionManager:te.actions.manager},r.a.createElement(h,{stateManager:f}))),r.a.createElement(X,{messages:a.messages,setMessages:function(e){return i({messages:e})}}))}i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ae,null)),document.getElementById("root"))},53:function(e,t,a){e.exports=a(157)},60:function(e,t,a){}},[[53,1,2]]]);
//# sourceMappingURL=main.e8a69f47.chunk.js.map